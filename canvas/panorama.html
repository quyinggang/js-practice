<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>全景图片</title>
    <style>
      body {
        margin: 0;
        padding: 0;
        width: 100%;
        height: 100%;
      }
      #canvas {
        border: 1px solid #ddd;
      }
    </style>
  </head>
  <body>
    <canvas id="canvas" width="800" height="200"></canvas>
    <script>
      const canvasElement = document.getElementById("canvas");
      const ctx = canvasElement.getContext("2d");

      const image = new Image();

      image.src = "./images/national.jpg";
      var canvasXSize = 800;
      var canvasYSize = 200;
      var dx = 0.75;
      var imgW;
      var imgH;
      var x = 0;
      var y = 0;

      image.onload = () => {
        imgW = image.width;
        imgH = image.height;
        draw();
      };

      // 第一种方式：动态计算绘制图片起始位置实现全景
      function draw() {
        ctx.clearRect(0, 0, 800, 200);
        if (x > canvasXSize) {
            x = canvasXSize - imgW;
        }
        if (x > canvasXSize - imgW) {
          // 图片绘制支持负坐标
          ctx.drawImage(image, x - imgW, y, imgW, imgH);
        }
        ctx.drawImage(image, x, y, imgW, imgH);
        x += dx;
        requestAnimationFrame(draw);
      }

      // 第二种方式：移动图片实现全景
      // function draw() {
      //   ctx.save();
      //   ctx.clearRect(0, 0, 800, 200);
      //   ctx.translate(-x, 0);
      //   ctx.drawImage(image, 0, 0);
      //   ctx.drawImage(image, canvasXSize, 0);
      //   x += dx;
      //   if (x >= canvasXSize) {
      //     x = 0;
      //   }
      //   ctx.restore();
      //   requestAnimationFrame(draw);
      // }
    </script>
  </body>
</html>
